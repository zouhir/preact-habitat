{"version":3,"file":"preact-habitat.es.js","sources":["../src/lib.js","../src/index.js"],"sourcesContent":["import { h, render } from \"preact\";\n/**\n * Removes `-` fron a string and capetalize the letter after\n * example: data-props-hello-world =>  dataPropsHelloWorld\n * Used for props passed from host DOM element\n * @param  {String} str string\n * @return {String} Capetalized string\n */\nconst camelcasize = str => {\n  return str.replace(/-([a-z])/gi, (all, letter) => {\n    return letter.toUpperCase();\n  });\n};\n\n/**\n * [getExecutedScript internal widget to provide the currently executed script]\n * @param  {document} document [Browser document object]\n * @return {HTMLElement}     [script Element]\n */\nconst getExecutedScript = () => {\n  return (\n    document.currentScript ||\n    (() => {\n      let scripts = document.getElementsByTagName(\"script\");\n      return scripts[scripts.length - 1];\n    })()\n  );\n};\n\n/**\n * Get the props from a host element's data attributes\n * @param  {Element} tag The host element\n * @return {Object}  props object to be passed to the component\n */\nconst collectPropsFromElement = (element, defaultProps = {}) => {\n  let attrs = element.attributes;\n\n  let props = Object.assign({}, defaultProps);\n\n  // collect from element\n  Object.keys(attrs).forEach(key => {\n    if (attrs.hasOwnProperty(key)) {\n      let dataAttrName = attrs[key].name;\n      if (!dataAttrName || typeof dataAttrName !== \"string\") {\n        return false;\n      }\n      let propName = dataAttrName.split(/(data-props?-)/).pop() || '';\n      propName = camelcasize(propName);\n      if (dataAttrName !== propName) {\n        let propValue = attrs[key].nodeValue;\n        props[propName] = propValue;\n      }\n    }\n  });\n\n  // check for child script text/props\n  [].forEach.call(element.getElementsByTagName('script'), scrp => {\n    let propsObj = {}\n    if(scrp.hasAttribute('type')) {\n      if (scrp.getAttribute('type') !== 'text/props' ) return;\n      try {\n        propsObj = JSON.parse(scrp.innerHTML);\n      } catch(e) {\n        throw new Error(e)\n      }\n      Object.assign(props, propsObj)\n    }\n  });  \n\n  return props;\n};\n\nconst getHabitatSelectorFromClient = (currentScript) => {\n  let scriptTagAttrs = currentScript.attributes;\n  let selector = null;\n  // check for another props attached to the tag\n  Object.keys(scriptTagAttrs).forEach(key => {\n    if (scriptTagAttrs.hasOwnProperty(key)) {\n      const dataAttrName = scriptTagAttrs[key].name;\n      if (dataAttrName === 'data-mount-in') {\n        selector = scriptTagAttrs[key].nodeValue;\n      }\n    }\n  });\n  return selector\n}\n\n/**\n * Return array of 0 or more elements that will host our widget\n * @param  {id} attrId the data widget id attribute the host should have\n * @param  {document} scope  Docuemnt object or DOM Element as a scope\n * @return {Array}        Array of matching habitats\n */\nconst widgetDOMHostElements = (\n  { selector, inline, clientSpecified}\n) => {\n  let hostNodes = [];\n  let currentScript = getExecutedScript();\n\n  if (inline === true) {\n    let parentNode = currentScript.parentNode;\n    hostNodes.push(parentNode);\n  }\n  if (clientSpecified === true && !selector) {\n    // user did not specify where to mount - get it from script tag attributes\n    selector = getHabitatSelectorFromClient(currentScript);\n  }\n  if (selector) {\n    [].forEach.call(document.querySelectorAll(selector), queriedTag => {\n      hostNodes.push(queriedTag);\n    });\n  }\n  return hostNodes;\n};\n\n/**\n * preact render function that will be queued if the DOM is not ready\n * and executed immeidatly if DOM is ready\n */\nconst preactRender = (widget, hostElements, root, cleanRoot, defaultProps) => {\n  hostElements.forEach(elm => {\n    let hostNode = elm;\n    if (hostNode._habitat) {\n      return; \n    }\n    hostNode._habitat = true;\n    let props = collectPropsFromElement(elm, defaultProps) || defaultProps;\n    if(cleanRoot) {\n      hostNode.innerHTML = \"\";\n    }\n    return render(h(widget, props), hostNode, root);\n  });\n};\n\nexport {\n  collectPropsFromElement,\n  widgetDOMHostElements,\n  getExecutedScript,\n  camelcasize,\n  preactRender,\n  getHabitatSelectorFromClient\n};\n","import { widgetDOMHostElements, preactRender } from \"./lib\";\n\nconst habitat = Widget => {\n  // Widget represents the Preact component we need to mount\n  let widget = Widget;\n  // preact root render helper\n  let root = null;\n\n  let render = (\n    {\n      selector = null,\n      inline = false,\n      clean = false,\n      clientSpecified = false,\n      defaultProps = {}\n    } = {}\n  ) => {\n    let elements = widgetDOMHostElements({\n      selector,\n      inline,\n      clientSpecified\n    });\n    let loaded = () => {\n      if (elements.length > 0) {\n        let elements = widgetDOMHostElements({\n          selector,\n          inline,\n          clientSpecified\n        });\n\n        return preactRender(widget, elements, root, clean, defaultProps);\n      }\n    };\n    loaded();\n    document.addEventListener(\"DOMContentLoaded\", loaded);\n    document.addEventListener(\"load\", loaded);\n  };\n\n  return { render };\n};\n\nexport default habitat;\n"],"names":["const","let","render","elements"],"mappings":"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"}